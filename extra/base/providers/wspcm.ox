IyEvdXNyL2Jpbi9lbnYgLVMgdXYgcnVuIC0tc2NyaXB0CiMgLy8vIHNjcmlwdAojIHJlcXVpcmVz
LXB5dGhvbiA9ICI+PTMuMTIiCiMgZGVwZW5kZW5jaWVzID0gWyJiczQiLCAicmVxdWVzdHMiXQoj
IC8vLwoKIiIiCkFudWJpcyBQcm9vZi1vZi1Xb3JrIENoYWxsZW5nZSBTb2x2ZXIKRGV0ZWN0cyBh
bmQgc29sdmVzIEFudWJpcyBjaGFsbGVuZ2VzIHRvIGJ5cGFzcyBib3QgcHJvdGVjdGlvbgoiIiIK
CmltcG9ydCByZXF1ZXN0cwppbXBvcnQganNvbgppbXBvcnQgaGFzaGxpYgppbXBvcnQgdGltZQpm
cm9tIGJzNCBpbXBvcnQgQmVhdXRpZnVsU291cApmcm9tIHVybGxpYi5wYXJzZSBpbXBvcnQgdXJs
am9pbiwgdXJsZW5jb2RlCmltcG9ydCByZQoKCmNsYXNzIEFudWJpc1NvbHZlcjoKICAgIGRlZiBf
X2luaXRfXyhzZWxmLCBzZXNzaW9uPU5vbmUpOgogICAgICAgIHNlbGYuc2Vzc2lvbiA9IHNlc3Np
b24gb3IgcmVxdWVzdHMuU2Vzc2lvbigpCiAgICAgICAgIyBTZXQgYSByZWFsaXN0aWMgdXNlciBh
Z2VudAogICAgICAgIHNlbGYuc2Vzc2lvbi5oZWFkZXJzLnVwZGF0ZSh7CiAgICAgICAgICAgICdV
c2VyLUFnZW50JzogJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFw
cGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMjAuMC4wLjAgU2Fm
YXJpLzUzNy4zNicKICAgICAgICB9KQoKICAgIGRlZiBpc19hbnViaXNfY2hhbGxlbmdlKHNlbGYs
IHJlc3BvbnNlKToKICAgICAgICAiIiJEZXRlY3QgaWYgdGhlIHJlc3BvbnNlIGNvbnRhaW5zIGFu
IEFudWJpcyBjaGFsbGVuZ2UiIiIKICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSAhPSAy
MDA6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICBjb250ZW50ID0gcmVzcG9uc2Uu
dGV4dC5sb3dlcigpCiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgJ2FudWJpcycgaW4gY29u
dGVudCBhbmQKICAgICAgICAgICAgJ21ha2luZyBzdXJlIHlvdScgaW4gY29udGVudCBhbmQKICAg
ICAgICAgICAgJ25vdCBhIGJvdCcgaW4gY29udGVudCBhbmQKICAgICAgICAgICAgJ2FudWJpc19j
aGFsbGVuZ2UnIGluIGNvbnRlbnQKICAgICAgICApCgogICAgZGVmIGV4dHJhY3RfY2hhbGxlbmdl
X2RhdGEoc2VsZiwgaHRtbF9jb250ZW50KToKICAgICAgICAiIiJFeHRyYWN0IGNoYWxsZW5nZSBk
YXRhIGZyb20gSFRNTCIiIgogICAgICAgIHNvdXAgPSBCZWF1dGlmdWxTb3VwKGh0bWxfY29udGVu
dCwgJ2h0bWwucGFyc2VyJykKCiAgICAgICAgIyBFeHRyYWN0IGNoYWxsZW5nZSBkYXRhCiAgICAg
ICAgY2hhbGxlbmdlX3NjcmlwdCA9IHNvdXAuZmluZCgnc2NyaXB0JywgaWQ9J2FudWJpc19jaGFs
bGVuZ2UnKQogICAgICAgIGlmIG5vdCBjaGFsbGVuZ2Vfc2NyaXB0OgogICAgICAgICAgICByYWlz
ZSBWYWx1ZUVycm9yKCJDb3VsZCBub3QgZmluZCBhbnViaXNfY2hhbGxlbmdlIHNjcmlwdCB0YWci
KQoKICAgICAgICBjaGFsbGVuZ2VfZGF0YSA9IGpzb24ubG9hZHMoY2hhbGxlbmdlX3NjcmlwdC5z
dHJpbmcuc3RyaXAoKSkKCiAgICAgICAgIyBFeHRyYWN0IGJhc2UgcHJlZml4CiAgICAgICAgcHJl
Zml4X3NjcmlwdCA9IHNvdXAuZmluZCgnc2NyaXB0JywgaWQ9J2FudWJpc19iYXNlX3ByZWZpeCcp
CiAgICAgICAgaWYgbm90IHByZWZpeF9zY3JpcHQ6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJy
b3IoIkNvdWxkIG5vdCBmaW5kIGFudWJpc19iYXNlX3ByZWZpeCBzY3JpcHQgdGFnIikKCiAgICAg
ICAgYmFzZV9wcmVmaXggPSBqc29uLmxvYWRzKHByZWZpeF9zY3JpcHQuc3RyaW5nLnN0cmlwKCkp
CgogICAgICAgIHJldHVybiBjaGFsbGVuZ2VfZGF0YSwgYmFzZV9wcmVmaXgKCiAgICBkZWYgc29s
dmVfcG93KHNlbGYsIGNoYWxsZW5nZSwgZGlmZmljdWx0eSk6CiAgICAgICAgIiIiU29sdmUgdGhl
IHByb29mLW9mLXdvcmsgY2hhbGxlbmdlIiIiCiAgICAgICAgcHJpbnQoZiJTb2x2aW5nIFBvVyBj
aGFsbGVuZ2U6IHtjaGFsbGVuZ2V9IikKICAgICAgICBwcmludChmIkRpZmZpY3VsdHk6IHtkaWZm
aWN1bHR5fSIpCgogICAgICAgIG5vbmNlID0gMAogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRp
bWUoKQoKICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAjIENyZWF0ZSB0aGUgc3RyaW5n
IHRvIGhhc2g6IGNoYWxsZW5nZSArIG5vbmNlCiAgICAgICAgICAgIHRlc3Rfc3RyaW5nID0gY2hh
bGxlbmdlICsgc3RyKG5vbmNlKQoKICAgICAgICAgICAgIyBDYWxjdWxhdGUgU0hBLTI1NiBoYXNo
CiAgICAgICAgICAgIGhhc2hfYnl0ZXMgPSBoYXNobGliLnNoYTI1Nih0ZXN0X3N0cmluZy5lbmNv
ZGUoKSkuZGlnZXN0KCkKICAgICAgICAgICAgaGFzaF9oZXggPSBoYXNoX2J5dGVzLmhleCgpCgog
ICAgICAgICAgICAjIENoZWNrIGlmIGhhc2ggc3RhcnRzIHdpdGggZW5vdWdoIHplcm9zCiAgICAg
ICAgICAgIGlmIGhhc2hfaGV4LnN0YXJ0c3dpdGgoJzAnICogZGlmZmljdWx0eSk6CiAgICAgICAg
ICAgICAgICBlbGFwc2VkID0gdGltZS50aW1lKCkgLSBzdGFydF90aW1lCiAgICAgICAgICAgICAg
ICBwcmludChmIkZvdW5kIHNvbHV0aW9uISBOb25jZToge25vbmNlfSwgSGFzaDoge2hhc2hfaGV4
fSIpCiAgICAgICAgICAgICAgICBwcmludChmIlNvbHZlZCBpbiB7ZWxhcHNlZDouMmZ9IHNlY29u
ZHMgKHtub25jZS9lbGFwc2VkOi4wZn0gSC9zKSIpCiAgICAgICAgICAgICAgICByZXR1cm4gaGFz
aF9oZXgsIG5vbmNlCgogICAgICAgICAgICBub25jZSArPSAxCgogICAgICAgICAgICAjIFByb2dy
ZXNzIGluZGljYXRvciBldmVyeSAxMDAwMCBpdGVyYXRpb25zCiAgICAgICAgICAgIGlmIG5vbmNl
ICUgMTAwMDAgPT0gMDoKICAgICAgICAgICAgICAgIGVsYXBzZWQgPSB0aW1lLnRpbWUoKSAtIHN0
YXJ0X3RpbWUKICAgICAgICAgICAgICAgIGlmIGVsYXBzZWQgPiAwOgogICAgICAgICAgICAgICAg
ICAgIHJhdGUgPSBub25jZSAvIGVsYXBzZWQKICAgICAgICAgICAgICAgICAgICBwcmludChmIlBy
b2dyZXNzOiB7bm9uY2V9IGl0ZXJhdGlvbnMsIHtyYXRlOi4wZn0gSC9zIikKCiAgICBkZWYgc3Vi
bWl0X3NvbHV0aW9uKHNlbGYsIGJhc2VfdXJsLCBiYXNlX3ByZWZpeCwgcmVzcG9uc2VfaGFzaCwg
bm9uY2UsIHJlZGlyZWN0X3VybCwgZWxhcHNlZF90aW1lKToKICAgICAgICAiIiJTdWJtaXQgdGhl
IHByb29mLW9mLXdvcmsgc29sdXRpb24iIiIKICAgICAgICAjIENvbnN0cnVjdCB0aGUgc3VibWlz
c2lvbiBVUkwKICAgICAgICBpZiBiYXNlX3ByZWZpeDoKICAgICAgICAgICAgYXBpX3BhdGggPSBm
IntiYXNlX3ByZWZpeH0vLndpdGhpbi53ZWJzaXRlL3gvY21kL2FudWJpcy9hcGkvcGFzcy1jaGFs
bGVuZ2UiCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYXBpX3BhdGggPSAiLy53aXRoaW4ud2Vi
c2l0ZS94L2NtZC9hbnViaXMvYXBpL3Bhc3MtY2hhbGxlbmdlIgoKICAgICAgICBzdWJtaXRfdXJs
ID0gdXJsam9pbihiYXNlX3VybCwgYXBpX3BhdGgpCgogICAgICAgICMgUGFyYW1ldGVycyBmb3Ig
dGhlIHN1Ym1pc3Npb24KICAgICAgICBwYXJhbXMgPSB7CiAgICAgICAgICAgICdyZXNwb25zZSc6
IHJlc3BvbnNlX2hhc2gsCiAgICAgICAgICAgICdub25jZSc6IHN0cihub25jZSksCiAgICAgICAg
ICAgICdyZWRpcic6IHJlZGlyZWN0X3VybCwKICAgICAgICAgICAgJ2VsYXBzZWRUaW1lJzogc3Ry
KGludChlbGFwc2VkX3RpbWUgKiAxMDAwKSkgICMgQ29udmVydCB0byBtaWxsaXNlY29uZHMKICAg
ICAgICB9CgogICAgICAgIHN1Ym1pdF91cmxfd2l0aF9wYXJhbXMgPSBmIntzdWJtaXRfdXJsfT97
dXJsZW5jb2RlKHBhcmFtcyl9IgogICAgICAgIHByaW50KGYiU3VibWl0dGluZyBzb2x1dGlvbiB0
bzoge3N1Ym1pdF91cmxfd2l0aF9wYXJhbXN9IikKCiAgICAgICAgIyBNYWtlIHRoZSBzdWJtaXNz
aW9uIHJlcXVlc3QKICAgICAgICByZXNwb25zZSA9IHNlbGYuc2Vzc2lvbi5nZXQoc3VibWl0X3Vy
bF93aXRoX3BhcmFtcywgYWxsb3dfcmVkaXJlY3RzPVRydWUpCiAgICAgICAgcmV0dXJuIHJlc3Bv
bnNlCgogICAgZGVmIHNvbHZlX2NoYWxsZW5nZShzZWxmLCB1cmwpOgogICAgICAgICIiIk1haW4g
bWV0aG9kIHRvIGRldGVjdCBhbmQgc29sdmUgQW51YmlzIGNoYWxsZW5nZSIiIgogICAgICAgIHBy
aW50KGYiRmV0Y2hpbmc6IHt1cmx9IikKCiAgICAgICAgIyBGaXJzdCwgdHJ5IHRvIGFjY2VzcyB0
aGUgVVJMCiAgICAgICAgcmVzcG9uc2UgPSBzZWxmLnNlc3Npb24uZ2V0KHVybCkKCiAgICAgICAg
IyBDaGVjayBpZiBpdCdzIGFuIEFudWJpcyBjaGFsbGVuZ2UKICAgICAgICBpZiBub3Qgc2VsZi5p
c19hbnViaXNfY2hhbGxlbmdlKHJlc3BvbnNlKToKICAgICAgICAgICAgcHJpbnQoIk5vIEFudWJp
cyBjaGFsbGVuZ2UgZGV0ZWN0ZWQiKQogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UKCiAgICAg
ICAgcHJpbnQoIkFudWJpcyBjaGFsbGVuZ2UgZGV0ZWN0ZWQhIikKCiAgICAgICAgIyBFeHRyYWN0
IGNoYWxsZW5nZSBkYXRhCiAgICAgICAgdHJ5OgogICAgICAgICAgICBjaGFsbGVuZ2VfZGF0YSwg
YmFzZV9wcmVmaXggPSBzZWxmLmV4dHJhY3RfY2hhbGxlbmdlX2RhdGEocmVzcG9uc2UudGV4dCkK
ICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiRmFpbGVk
IHRvIGV4dHJhY3QgY2hhbGxlbmdlIGRhdGE6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiByZXNw
b25zZQoKICAgICAgICAjIEdldCBjaGFsbGVuZ2UgcGFyYW1ldGVycwogICAgICAgIHJ1bGVzID0g
Y2hhbGxlbmdlX2RhdGFbJ3J1bGVzJ10KICAgICAgICBjaGFsbGVuZ2UgPSBjaGFsbGVuZ2VfZGF0
YVsnY2hhbGxlbmdlJ10KICAgICAgICBkaWZmaWN1bHR5ID0gcnVsZXNbJ2RpZmZpY3VsdHknXQoK
ICAgICAgICAjIFNvbHZlIHRoZSBwcm9vZi1vZi13b3JrCiAgICAgICAgc3RhcnRfdGltZSA9IHRp
bWUudGltZSgpCiAgICAgICAgcmVzcG9uc2VfaGFzaCwgbm9uY2UgPSBzZWxmLnNvbHZlX3Bvdyhj
aGFsbGVuZ2UsIGRpZmZpY3VsdHkpCiAgICAgICAgZWxhcHNlZF90aW1lID0gdGltZS50aW1lKCkg
LSBzdGFydF90aW1lCgogICAgICAgICMgU3VibWl0IHRoZSBzb2x1dGlvbgogICAgICAgIHNvbHV0
aW9uX3Jlc3BvbnNlID0gc2VsZi5zdWJtaXRfc29sdXRpb24oCiAgICAgICAgICAgIHJlc3BvbnNl
LnVybCwKICAgICAgICAgICAgYmFzZV9wcmVmaXgsCiAgICAgICAgICAgIHJlc3BvbnNlX2hhc2gs
CiAgICAgICAgICAgIG5vbmNlLAogICAgICAgICAgICB1cmwsCiAgICAgICAgICAgIGVsYXBzZWRf
dGltZQogICAgICAgICkKCiAgICAgICAgcHJpbnQoIkNoYWxsZW5nZSBzb2x2ZWQgYW5kIHN1Ym1p
dHRlZCEiKQogICAgICAgIHByaW50KGYiRmluYWwgVVJMOiB7c29sdXRpb25fcmVzcG9uc2UudXJs
fSIpCiAgICAgICAgcHJpbnQoZiJTdGF0dXM6IHtzb2x1dGlvbl9yZXNwb25zZS5zdGF0dXNfY29k
ZX0iKQoKICAgICAgICByZXR1cm4gc29sdXRpb25fcmVzcG9uc2UKCgpkZWYgbWFpbigpOgogICAg
IiIiRXhhbXBsZSB1c2FnZSIiIgogICAgaW1wb3J0IHN5cwoKICAgIGlmIGxlbihzeXMuYXJndikg
IT0gMjoKICAgICAgICBwcmludCgiVXNhZ2U6IHB5dGhvbiBhbnViaXNfc29sdmVyLnB5IDx1cmw+
IikKICAgICAgICBzeXMuZXhpdCgxKQoKICAgIHVybCA9IHN5cy5hcmd2WzFdCgogICAgIyBDcmVh
dGUgc29sdmVyIGFuZCBzb2x2ZSBjaGFsbGVuZ2UKICAgIHNvbHZlciA9IEFudWJpc1NvbHZlcigp
CiAgICByZXNwb25zZSA9IHNvbHZlci5zb2x2ZV9jaGFsbGVuZ2UodXJsKQoKICAgICMgUHJpbnQg
dGhlIGZpbmFsIGNvbnRlbnQgKG9yIGZpcnN0IDUwMCBjaGFycykKICAgIHByaW50KCJcbiIgKyAi
PSIqNTApCiAgICBwcmludCgiRklOQUwgUkVTUE9OU0U6IikKICAgIHByaW50KCI9Iio1MCkKICAg
IHByaW50KHJlc3BvbnNlLnRleHRbOjUwMF0pCiAgICBpZiBsZW4ocmVzcG9uc2UudGV4dCkgPiA1
MDA6CiAgICAgICAgcHJpbnQoIi4uLiAodHJ1bmNhdGVkKSIpCgoKaWYgX19uYW1lX18gPT0gIl9f
bWFpbl9fIjoKICAgIG1haW4oKQo=
